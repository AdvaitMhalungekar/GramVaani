<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Gramvaani - Voice of the Village</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>

<body>
    <script src="{{ url_for('static', filename='script.js') }}"></script>
    <div id="google_translate_element"></div>
    <nav class="navbar">
        <div class="container nav-container">
            <!-- Logo Section -->
            <div class="logo">
                <div class="logo-icon">
                    <img src="{{ url_for('static', filename='assets/logo.png') }}" alt="Gramvaani Logo"
                        class="logo-img">
                </div>
                <div class="logo-text">Gram<span class="accent">vaani</span></div>
            </div>

            <!-- Header Actions (Language + Mic) -->
            <div class="header-actions">
                <div class="language-mic-wrapper">
                    <!-- Google Translate Placeholder -->
                    <div id="google_translate_element"></div>

                    <!-- Microphone Button -->
                    <!-- üîä Read Selected Text Button -->
                    <button class="mic-navbar" onclick="readSelectedText()" title="Read Selected Text">
                        <i class="fas fa-volume-up"></i>
                    </button>

                </div>
            </div>
        </div>
    </nav>

    <style>
        /* Google Translate Element Styling */
        #google_translate_element {
            margin-right: 15px;
        }

        /* Style the Google Translate dropdown to match your site */
        .goog-te-gadget {
            font-family: 'Poppins', sans-serif !important;
            font-size: 14px !important;
            color: var(--text-primary) !important;
        }

        .goog-te-gadget .goog-te-combo {
            padding: 5px 10px;
            border-radius: var(--border-radius);
            border: 1px solid var(--primary-light);
            outline: none;
            background-color: var(--card-bg);
            color: var(--text-primary);
            font-family: 'Poppins', sans-serif;
        }

        /* Hide some elements from the Google Translate widget */
        .goog-te-gadget-simple img,
        .goog-te-banner-frame,
        .goog-te-menu-value span:nth-child(3),
        .goog-te-menu-value span:nth-child(5) {
            display: none !important;
        }

        /* Style the powered by text */
        .goog-te-gadget-simple span:last-child {
            font-size: 0;
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            #google_translate_element {
                margin-right: 5px;
            }

            .goog-te-gadget {
                font-size: 12px !important;
            }
        }
    </style>

    <div class="hero-section">
        <div class="container">
            <h1 class="greeting-title">‡§®‡§Æ‡§∏‡•ç‡§§‡•á! ‡§ï‡•à‡§∏‡•á ‡§Æ‡§¶‡§¶ ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç?</h1>
            <p class="greeting-subtitle">How can we help you today?</p>
        </div>
    </div>

    <div class="container">
        <!-- Main Services -->
        <div class="main-services">
            <!-- Agricultural Advisory -->
            <a href="/agri" style="text-decoration: none; color: inherit;">
                <div class="service-card">
                    <div class="service-icon-container agri-bg">
                        <i class="fas fa-seedling service-icon agri-icon"></i>
                    </div>
                    <div class="service-info">
                        <h2 class="service-title">Agricultural Advisory</h2>
                        <p class="service-description">Get expert tips and updates for your farm</p>
                        <div class="service-action">
                            <span>Get Started</span>
                            <i class="fas fa-arrow-right"></i>
                        </div>
                    </div>
                </div>
            </a>

            <!-- Healthcare -->
            <a href="/health" style="text-decoration: none; color: inherit;">
                <div class="service-card">
                    <div class="service-icon-container health-bg">
                        <i class="fas fa-heartbeat service-icon health-icon"></i>
                    </div>
                    <div class="service-info">
                        <h2 class="service-title">Healthcare</h2>
                        <p class="service-description">Medical info & support for your family</p>
                        <div class="service-action">
                            <span>Explore</span>
                            <i class="fas fa-arrow-right"></i>
                        </div>
                    </div>
                </div>
            </a>

            <!-- Government Schemes -->
            <a href="/gov" style="text-decoration: none; color: inherit;">
                <div class="service-card">
                    <div class="service-icon-container govt-bg">
                        <i class="fas fa-landmark service-icon govt-icon"></i>
                    </div>
                    <div class="service-info">
                        <h2 class="service-title">Govt. Schemes</h2>
                        <p class="service-description">Check your eligibility for benefits</p>
                        <div class="service-action">
                            <span>Learn More</span>
                            <i class="fas fa-arrow-right"></i>
                        </div>
                    </div>
                </div>
            </a>

            <!-- Weather -->
            <a href="/weather" style="text-decoration: none; color: inherit;">
                <div class="service-card">
                    <div class="service-icon-container weather-bg">
                        <i class="fas fa-cloud-sun service-icon weather-icon"></i>
                    </div>
                    <div class="service-info">
                        <h2 class="service-title">Weather Updates</h2>
                        <p class="service-description">Local forecast for better planning</p>
                        <div class="service-action">
                            <span>Check Now</span>
                            <i class="fas fa-arrow-right"></i>
                        </div>
                    </div>
                </div>
            </a>

        </div>

        <!-- Feature banner -->
        <div class="feature-banner">
            <div class="feature-content">
                <h2>Voice-First Experience</h2>
                <p>Speak in your language to access all services. Perfect for when your hands are busy.</p>
                <button class="feature-btn">Try Voice Commands</button>
            </div>
            <div class="feature-image">
                <i class="fas fa-microphone-alt"></i>
            </div>
        </div>

        <!-- Farmer Testimonials Section -->
        <div class="testimonial-section">
            <h2 class="section-title"><i class="fas fa-wheat-awn"></i> Farmer Stories</h2>
            <div class="testimonial-cards">
                <div class="testimonial-card">
                    <div class="quote-icon"><i class="fas fa-quote-left"></i></div>
                    <p class="testimonial-text">Thanks to Gramvaani, I learned the best time to sow my crops. My yield
                        improved by 30% this season!</p>
                    <div class="testimonial-footer">
                        <div class="testimonial-avatar">
                            <i class="fas fa-user-circle"></i>
                        </div>
                        <p class="testimonial-name">Ramesh, Maharashtra</p>
                    </div>
                </div>
                <div class="testimonial-card">
                    <div class="quote-icon"><i class="fas fa-quote-left"></i></div>
                    <p class="testimonial-text">The health tips helped me take better care of my family during monsoon
                        season. Truly a lifeline for rural communities.</p>
                    <div class="testimonial-footer">
                        <div class="testimonial-avatar">
                            <i class="fas fa-user-circle"></i>
                        </div>
                        <p class="testimonial-name">Sita, Madhya Pradesh</p>
                    </div>
                </div>
                <div class="testimonial-card">
                    <div class="quote-icon"><i class="fas fa-quote-left"></i></div>
                    <p class="testimonial-text">I discovered a new government scheme that helped with irrigation costs.
                        The application process was simple with guidance.</p>
                    <div class="testimonial-footer">
                        <div class="testimonial-avatar">
                            <i class="fas fa-user-circle"></i>
                        </div>
                        <p class="testimonial-name">Mohan, Bihar</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-logo">
                    <img src="{{ url_for('static', filename='assets/logo.png') }}" alt="Gramvaani Logo"
                        class="footer-logo-img">
                    <span>Gramvaani</span>
                </div>
                <p class="footer-tagline">Voice of the Village</p>
            </div>
            <div class="footer-links">
                <a href="#">About Us</a>
                <a href="#">Privacy Policy</a>
                <a href="#">Contact</a>
                <a href="#">Help</a>
            </div>
        </div>
    </footer>

    <div class="mic-button">
        <div class="pulse-ring"></div>
        <div class="mic-icon">
            <i class="fas fa-microphone"></i>
        </div>
        <div class="mic-tooltip">Tap to speak</div>
    </div>

    <script>
        function toggleDropdown() {
            const dropdown = document.getElementById('languageDropdown');
            dropdown.style.display = dropdown.style.display === 'block' ? 'none' : 'block';
        }

        window.addEventListener('click', function (e) {
            const langSelector = document.querySelector('.language-selector');
            const dropdown = document.getElementById('languageDropdown');
            if (!langSelector.contains(e.target)) {
                dropdown.style.display = 'none';
            }
        });

        // Add animation class on scroll
        window.addEventListener('scroll', function () {
            const cards = document.querySelectorAll('.service-card, .testimonial-card');

            cards.forEach(card => {
                const cardPosition = card.getBoundingClientRect().top;
                const screenPosition = window.innerHeight / 1.2;

                if (cardPosition < screenPosition) {
                    card.classList.add('animate');
                }
            });
        });

        // Add this script at the end of your HTML file, before the closing </body> tag

        // Initialize the Web Speech API
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        const recognition = new SpeechRecognition();

        // Configure speech recognition
        recognition.continuous = false;
        recognition.interimResults = false;
        recognition.lang = 'hi-IN'; // Default to Hindi, can be changed based on selected language

        // Select all mic buttons
        const micButtons = document.querySelectorAll('.mic-button, .mic-navbar');

        // Set up event listeners for all mic buttons
        micButtons.forEach(button => {
            button.addEventListener('click', startVoiceRecognition);
        });

        // Function to start voice recognition
        function startVoiceRecognition() {
            // Visual feedback - add active class
            document.querySelector('.mic-button').classList.add('active');
            document.querySelector('.mic-tooltip').textContent = 'Listening...';

            // Start recognition
            recognition.start();
        }

        // Handle speech recognition results
        recognition.onresult = function (event) {
            const result = event.results[0][0].transcript;
            console.log('Voice input:', result);

            // Show processing feedback
            document.querySelector('.mic-tooltip').textContent = 'Processing...';

            // Send the speech input to the server
            processVoiceCommand(result);
        };

        // Handle errors
        recognition.onerror = function (event) {
            console.error('Speech recognition error:', event.error);
            resetMicButton('Tap to speak');
        };

        // When recognition ends
        recognition.onend = function () {
            // Don't reset here as we'll handle it after processing
        };

        // Process the voice command by sending it to the server
        function processVoiceCommand(text) {
            fetch('/process_voice', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ command: text }),
            })
                .then(response => response.json())
                .then(data => {
                    console.log('Server response:', data);

                    // Handle the redirect based on the response
                    if (data.redirect) {
                        // Show redirect feedback
                        document.querySelector('.mic-tooltip').textContent = `Going to ${data.page}...`;

                        // Wait a moment so user can see the feedback
                        setTimeout(() => {
                            window.location.href = data.redirect;
                        }, 1000);
                    } else {
                        resetMicButton('Try again');
                    }
                })
                .catch(error => {
                    console.error('Error processing voice command:', error);
                    resetMicButton('Error. Try again');
                });
        }

        // Reset the mic button
        function resetMicButton(message) {
            document.querySelector('.mic-button').classList.remove('active');
            document.querySelector('.mic-tooltip').textContent = message;

            // Reset to default message after a delay
            if (message !== 'Tap to speak') {
                setTimeout(() => {
                    document.querySelector('.mic-tooltip').textContent = 'Tap to speak';
                }, 3000);
            }
        }

        // Update language for speech recognition when user changes language
        document.querySelectorAll('.dropdown-item').forEach(item => {
            item.addEventListener('click', function () {
                const language = this.textContent;

                // Map languages to BCP 47 language tags
                const languageMap = {
                    'English': 'en-IN',
                    '‡§π‡§ø‡§®‡•ç‡§¶‡•Ä': 'hi-IN',
                    '‡§Æ‡§∞‡§æ‡§†‡•Ä': 'mr-IN',
                    '‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç': 'ta-IN',
                    '‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ': 'bn-IN',
                    '‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å': 'te-IN',
                    '‡™ó‡´Å‡™ú‡™∞‡™æ‡™§‡´Ä': 'gu-IN',
                    '‡¨ì‡¨°‡¨º‡¨ø‡¨Ü': 'or-IN',
                    '‡≤ï‡≤®‡≥ç‡≤®‡≤°': 'kn-IN',
                    '‡¥Æ‡¥≤‡¥Ø‡¥æ‡¥≥‡¥Ç': 'ml-IN'
                };

                recognition.lang = languageMap[language] || 'hi-IN';

                // Update the displayed language (optional)
                document.querySelector('.language-selector').innerHTML =
                    `<i class="fas fa-globe"></i> ${language} <i class="fas fa-chevron-down"></i>`;

                // Close the dropdown
                document.getElementById('languageDropdown').style.display = 'none';
            });
        });

        <!-- ‚úÖ NEW separate script block for readSelectedText -->

        function speakText(text) {
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = document.documentElement.lang || 'en-US';
                speechSynthesis.cancel(); // Stop any ongoing speech
                speechSynthesis.speak(utterance);
            } else {
                alert("Sorry, your browser doesn't support speech synthesis.");
            }
        }

        function readSelectedText() {
            const selectedText = window.getSelection().toString().trim();
            if (selectedText.length > 0) {
                speakText(selectedText);
            } else {
                alert("Please select some text to read aloud.");
            }
        }
    </script>
</body>

</html>